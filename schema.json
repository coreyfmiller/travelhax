{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "TravelHax Itinerary Schema",
  "description": "Structured data format for travel confirmations extracted from emails",
  "type": "object",
  "properties": {
    "extraction_metadata": {
      "type": "object",
      "description": "Information about the extraction process",
      "properties": {
        "extracted_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when extraction occurred"
        },
        "email_subject": {
          "type": "string",
          "description": "Original email subject line"
        },
        "email_from": {
          "type": "string",
          "description": "Sender email address"
        },
        "email_date": {
          "type": "string",
          "format": "date-time",
          "description": "When the email was sent"
        },
        "confidence_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall confidence in extraction accuracy (0-1)"
        },
        "is_travel_related": {
          "type": "boolean",
          "description": "Whether this email contains travel information"
        },
        "parser_version": {
          "type": "string",
          "description": "Version of the parser that processed this email"
        }
      },
      "required": ["extracted_at", "confidence_score", "is_travel_related"]
    },
    "events": {
      "type": "array",
      "description": "List of travel events extracted from the email",
      "items": {
        "type": "object",
        "properties": {
          "event_id": {
            "type": "string",
            "description": "Unique identifier for this event"
          },
          "event_type": {
            "type": "string",
            "enum": ["flight", "hotel", "rental_car", "activity", "restaurant", "train", "bus", "ferry", "parking", "other"],
            "description": "Type of travel event"
          },
          "status": {
            "type": "string",
            "enum": ["confirmed", "cancelled", "delayed", "modified", "pending"],
            "default": "confirmed",
            "description": "Current status of the booking"
          },
          "provider": {
            "type": "object",
            "description": "Service provider information",
            "properties": {
              "name": {
                "type": "string",
                "description": "Company name (e.g., 'Air Canada', 'Marriott')"
              },
              "support_phone": {
                "type": "string",
                "description": "Customer service phone number"
              },
              "support_email": {
                "type": "string",
                "description": "Customer service email"
              },
              "website": {
                "type": "string",
                "format": "uri",
                "description": "Provider website URL"
              }
            }
          },
          "confirmation": {
            "type": "object",
            "description": "Booking confirmation details",
            "properties": {
              "confirmation_code": {
                "type": "string",
                "description": "Primary confirmation/booking reference number"
              },
              "pnr": {
                "type": "string",
                "description": "Passenger Name Record (for flights)"
              },
              "ticket_number": {
                "type": "string",
                "description": "Ticket or voucher number"
              },
              "confidence": {
                "type": "number",
                "minimum": 0,
                "maximum": 1,
                "description": "Confidence in confirmation code accuracy"
              }
            }
          },
          "timing": {
            "type": "object",
            "description": "Event timing information with timezone support",
            "properties": {
              "start_datetime": {
                "type": "string",
                "format": "date-time",
                "description": "Start time in ISO 8601 format with timezone"
              },
              "end_datetime": {
                "type": "string",
                "format": "date-time",
                "description": "End time in ISO 8601 format with timezone"
              },
              "timezone": {
                "type": "string",
                "description": "IANA timezone identifier (e.g., 'America/New_York')"
              },
              "duration_minutes": {
                "type": "integer",
                "description": "Duration in minutes (calculated or extracted)"
              },
              "all_day_event": {
                "type": "boolean",
                "default": false,
                "description": "Whether this is an all-day event"
              }
            },
            "required": ["start_datetime"]
          },
          "location": {
            "type": "object",
            "description": "Location information",
            "properties": {
              "name": {
                "type": "string",
                "description": "Location name (hotel name, airport, venue)"
              },
              "address": {
                "type": "object",
                "properties": {
                  "street": { "type": "string" },
                  "city": { "type": "string" },
                  "state_province": { "type": "string" },
                  "postal_code": { "type": "string" },
                  "country": { "type": "string" },
                  "full_address": { "type": "string" }
                }
              },
              "coordinates": {
                "type": "object",
                "properties": {
                  "latitude": { "type": "number" },
                  "longitude": { "type": "number" }
                }
              },
              "terminal_gate": {
                "type": "string",
                "description": "Airport terminal/gate or specific location detail"
              }
            }
          },
          "flight_details": {
            "type": "object",
            "description": "Flight-specific information (only for event_type: flight)",
            "properties": {
              "airline": {
                "type": "string",
                "description": "Airline name"
              },
              "flight_number": {
                "type": "string",
                "description": "Flight number (e.g., 'AC123')"
              },
              "departure_airport": {
                "type": "object",
                "properties": {
                  "code": { "type": "string", "description": "IATA code (e.g., 'YYZ')" },
                  "name": { "type": "string" },
                  "terminal": { "type": "string" },
                  "gate": { "type": "string" }
                }
              },
              "arrival_airport": {
                "type": "object",
                "properties": {
                  "code": { "type": "string", "description": "IATA code" },
                  "name": { "type": "string" },
                  "terminal": { "type": "string" },
                  "gate": { "type": "string" }
                }
              },
              "seat": {
                "type": "string",
                "description": "Seat assignment"
              },
              "class": {
                "type": "string",
                "enum": ["economy", "premium_economy", "business", "first"],
                "description": "Cabin class"
              },
              "baggage_allowance": {
                "type": "string",
                "description": "Baggage allowance details"
              },
              "is_connecting_flight": {
                "type": "boolean",
                "description": "Whether this is part of a multi-leg journey"
              }
            }
          },
          "accommodation_details": {
            "type": "object",
            "description": "Hotel/Airbnb-specific information",
            "properties": {
              "check_in": {
                "type": "string",
                "format": "date-time",
                "description": "Check-in datetime with timezone"
              },
              "check_out": {
                "type": "string",
                "format": "date-time",
                "description": "Check-out datetime with timezone"
              },
              "room_type": {
                "type": "string",
                "description": "Room category/type"
              },
              "guest_name": {
                "type": "string",
                "description": "Primary guest name"
              },
              "number_of_guests": {
                "type": "integer",
                "description": "Total number of guests"
              },
              "number_of_nights": {
                "type": "integer",
                "description": "Number of nights"
              },
              "amenities": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Included amenities"
              }
            }
          },
          "rental_details": {
            "type": "object",
            "description": "Car rental-specific information",
            "properties": {
              "vehicle_type": {
                "type": "string",
                "description": "Vehicle category (e.g., 'Compact SUV')"
              },
              "pickup_location": {
                "type": "string",
                "description": "Pickup location name/address"
              },
              "dropoff_location": {
                "type": "string",
                "description": "Drop-off location name/address"
              },
              "pickup_datetime": {
                "type": "string",
                "format": "date-time"
              },
              "dropoff_datetime": {
                "type": "string",
                "format": "date-time"
              },
              "driver_name": {
                "type": "string"
              }
            }
          },
          "passengers": {
            "type": "array",
            "description": "List of travelers for this event",
            "items": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "type": { 
                  "type": "string",
                  "enum": ["adult", "child", "infant"]
                },
                "frequent_flyer_number": { "type": "string" }
              }
            }
          },
          "cost": {
            "type": "object",
            "description": "Pricing information",
            "properties": {
              "total": { "type": "number" },
              "currency": { "type": "string", "description": "ISO 4217 currency code" },
              "breakdown": {
                "type": "object",
                "properties": {
                  "base_price": { "type": "number" },
                  "taxes": { "type": "number" },
                  "fees": { "type": "number" }
                }
              },
              "payment_method": { "type": "string" }
            }
          },
          "important_notes": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Critical information (ID requirements, COVID rules, etc.)"
          },
          "attachments": {
            "type": "array",
            "description": "References to email attachments",
            "items": {
              "type": "object",
              "properties": {
                "filename": { "type": "string" },
                "type": { 
                  "type": "string",
                  "enum": ["pdf_ticket", "boarding_pass", "calendar_ics", "qr_code", "other"]
                },
                "url": { "type": "string", "format": "uri" }
              }
            }
          },
          "related_event_ids": {
            "type": "array",
            "items": { "type": "string" },
            "description": "IDs of related events (e.g., return flight, connecting flights)"
          },
          "raw_text_snippet": {
            "type": "string",
            "description": "Relevant excerpt from original email for verification"
          }
        },
        "required": ["event_type", "timing", "confirmation"]
      }
    }
  },
  "required": ["extraction_metadata", "events"]
}
